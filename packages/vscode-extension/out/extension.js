"use strict";var E=Object.create;var f=Object.defineProperty;var P=Object.getOwnPropertyDescriptor;var x=Object.getOwnPropertyNames;var I=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty;var U=(r,e)=>{for(var t in e)f(r,t,{get:e[t],enumerable:!0})},O=(r,e,t,o)=>{if(e&&typeof e=="object"||typeof e=="function")for(let n of x(e))!T.call(r,n)&&n!==t&&f(r,n,{get:()=>e[n],enumerable:!(o=P(e,n))||o.enumerable});return r};var A=(r,e,t)=>(t=r!=null?E(I(r)):{},O(e||!r||!r.__esModule?f(t,"default",{value:r,enumerable:!0}):t,r)),R=r=>O(f({},"__esModule",{value:!0}),r);var W={};U(W,{activate:()=>B,deactivate:()=>F});module.exports=R(W);var c=A(require("vscode")),k=A(require("crypto"));var y={MEMORIES:"lanonasis.memories.cache",PENDING_QUEUE:"lanonasis.memories.pending",LAST_SYNC:"lanonasis.memories.lastSync"},C=class{constructor(e,t){this.context=e;this.output=t;this.memories=[];this.pendingQueue=[];this.lastSyncAt=null;this.isSyncing=!1;this.isOnline=!0;this.loadFromStorage(),this.setupNetworkListener()}loadFromStorage(){try{let e=this.context.globalState.get(y.MEMORIES,[]),t=this.context.globalState.get(y.PENDING_QUEUE,[]),o=this.context.globalState.get(y.LAST_SYNC,null);this.memories=e,this.pendingQueue=t,this.lastSyncAt=o,this.output.appendLine(`[MemoryCache] Loaded ${this.memories.length} cached memories, ${this.pendingQueue.length} pending`)}catch(e){this.output.appendLine(`[MemoryCache] Load error: ${e}`)}}async saveToStorage(){try{await this.context.globalState.update(y.MEMORIES,this.memories),await this.context.globalState.update(y.PENDING_QUEUE,this.pendingQueue),await this.context.globalState.update(y.LAST_SYNC,this.lastSyncAt)}catch(e){this.output.appendLine(`[MemoryCache] Save error: ${e}`)}}setupNetworkListener(){this.isOnline=!0}getStatus(){return{isOnline:this.isOnline,lastSyncAt:this.lastSyncAt,pendingCount:this.pendingQueue.length,isSyncing:this.isSyncing}}getMemories(){return[...this.memories]}getPendingQueue(){return[...this.pendingQueue]}async updateFromApi(e){this.memories=e.map(t=>({...t,_cachedAt:Date.now()})),this.lastSyncAt=Date.now(),this.isOnline=!0,await this.saveToStorage(),this.output.appendLine(`[MemoryCache] Updated cache with ${e.length} memories from API`)}async addLocal(e){let t=`local_${Date.now()}_${Math.random().toString(36).slice(2)}`,o=new Date().toISOString(),n={...e,id:t,created_at:o,updated_at:o,_pending:"create",_localId:t,_cachedAt:Date.now()};return this.memories.unshift(n),this.pendingQueue.push(n),await this.saveToStorage(),this.output.appendLine(`[MemoryCache] Added local memory: ${n.title}`),n}async markSynced(e,t){let o=this.memories.findIndex(n=>n.id===e||n._localId===e);o!==-1&&(this.memories[o]={...t,_pending:void 0,_localId:void 0,_cachedAt:Date.now()}),this.pendingQueue=this.pendingQueue.filter(n=>n._localId!==e),await this.saveToStorage()}searchLocal(e){let t=e.toLowerCase();return this.memories.filter(o=>o.title.toLowerCase().includes(t)||o.content.toLowerCase().includes(t)||o.tags.some(n=>n.toLowerCase().includes(t)))}semanticSearchLocal(e){let t=e.toLowerCase(),o=[/find\s+(?:my\s+)?(.+)/i,/search\s+(?:for\s+)?(.+)/i,/show\s+(?:me\s+)?(.+)/i,/get\s+(?:my\s+)?(.+)/i,/recall\s+(.+)/i,/what\s+(?:was|were|is|are)\s+(?:my\s+)?(.+)/i,/where\s+(?:is|are|did)\s+(?:my\s+)?(.+)/i],n=t;for(let a of o){let d=t.match(a);if(d){n=d[1]||d[2]||t;break}}let s=["the","a","an","my","that","this","about","notes","note","memory","memories"],i=n.split(/\s+/).filter(a=>a.length>2&&!s.includes(a));return i.length===0?this.memories.slice(0,5):this.memories.map(a=>{let d=0,h=a.title.toLowerCase(),g=a.content.toLowerCase(),u=a.tags.map(w=>w.toLowerCase());for(let w of i)h.includes(w)&&(d+=3),g.includes(w)&&(d+=1),u.some(_=>_.includes(w))&&(d+=2);return{memory:a,score:d}}).filter(a=>a.score>0).sort((a,d)=>d.score-a.score).slice(0,10).map(a=>a.memory)}setOnline(e){this.isOnline=e}setSyncing(e){this.isSyncing=e}};var v=A(require("vscode")),$="lanonasis.memory",S=class{constructor(e,t,o,n,s){this.context=e;this.output=t;this.cache=o;this.apiUrl=n;this.getApiKey=s}register(){if(!v.chat?.createChatParticipant){this.output.appendLine("[ChatParticipant] Chat API not available in this VS Code version");return}try{this.participant=v.chat.createChatParticipant($,this.handleRequest.bind(this)),this.participant.iconPath=v.Uri.joinPath(this.context.extensionUri,"media","icon.png"),this.participant.followupProvider={provideFollowups:this.provideFollowups.bind(this)},this.context.subscriptions.push(this.participant),this.output.appendLine("[ChatParticipant] Registered @memory chat participant")}catch(e){this.output.appendLine(`[ChatParticipant] Registration failed: ${e}`)}}async handleRequest(e,t,o,n){let s=e.prompt.trim();this.output.appendLine(`[ChatParticipant] Request: "${s}"`);let i=await this.parseIntent(s);switch(i.action){case"search":return this.handleSearch(i,o,n);case"create":return this.handleCreate(s,o);case"list":return this.handleList(o);case"help":default:return this.handleHelp(o)}}async parseIntent(e){let t=e.toLowerCase();if(t==="help"||t==="?"||t.includes("how do i")||t.includes("what can you"))return{memories:[],action:"help"};if(t==="list"||t==="show all"||t==="all memories"||t.match(/^(list|show)\s*(all|my)?\s*memories?$/))return{memories:this.cache.getMemories().slice(0,10),action:"list"};let o=[/^save\s+(.+)/i,/^create\s+(?:a\s+)?(?:memory|note)\s*:?\s*(.+)/i,/^remember\s+(.+)/i,/^store\s+(.+)/i];for(let s of o)if(s.test(t))return{memories:[],action:"create",query:e};let n=this.cache.semanticSearchLocal(e);return n.length===0?{memories:await this.searchApi(e),action:"search",query:e}:{memories:n,action:"search",query:e}}async searchApi(e){try{let t=await this.getApiKey();if(!t)return[];let o=await fetch(`${this.apiUrl}/memories/search?q=${encodeURIComponent(e)}&limit=5`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!o.ok)return[];let n=await o.json();return n.memories||n||[]}catch(t){return this.output.appendLine(`[ChatParticipant] API search error: ${t}`),[]}}async handleSearch(e,t,o){if(o.isCancellationRequested)return{metadata:{action:"cancelled"}};if(e.memories.length===0)return t.markdown(`No memories found for "${e.query}".

`),t.markdown("\u{1F4A1} *Try creating a new memory with:* `@memory save [your content]`"),{metadata:{action:"search",found:0}};t.markdown(`## \u{1F9E0} Found ${e.memories.length} relevant memories

`);for(let n of e.memories){let s=n._pending?" *(pending sync)*":"";t.markdown(`### ${n.title}${s}
`),t.markdown(`${n.content.slice(0,200)}${n.content.length>200?"...":""}

`),n.tags.length>0&&t.markdown(`\u{1F3F7}\uFE0F ${n.tags.map(i=>`\`${i}\``).join(" ")}

`),t.markdown(`---

`)}return{metadata:{action:"search",found:e.memories.length}}}async handleCreate(e,t){let o=e.replace(/^(save|create|remember|store)\s*(a\s+)?(memory|note)?\s*:?\s*/i,"").trim();if(!o)return t.markdown(`Please provide content to save. Example:

`),t.markdown("`@memory save OAuth uses PKCE flow for mobile apps`"),{metadata:{action:"create",success:!1}};let n=o.slice(0,50)+(o.length>50?"...":""),s=await this.cache.addLocal({title:n,content:o,memory_type:"knowledge",tags:[]});return t.markdown(`## \u2705 Memory saved

`),t.markdown(`**${s.title}**

`),t.markdown(`${s.content}

`),t.markdown("*Memory will sync when online.*"),this.syncToApi(s),{metadata:{action:"create",success:!0,id:s.id}}}async syncToApi(e){try{let t=await this.getApiKey();if(!t)return;let o=await fetch(`${this.apiUrl}/memories`,{method:"POST",headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"},body:JSON.stringify({title:e.title,content:e.content,memory_type:e.memory_type,tags:e.tags})});if(o.ok){let n=await o.json();await this.cache.markSynced(e.id,n),this.output.appendLine(`[ChatParticipant] Memory synced: ${e.title}`)}}catch(t){this.output.appendLine(`[ChatParticipant] Sync error: ${t}`)}}handleList(e){let t=this.cache.getMemories().slice(0,10),o=this.cache.getStatus();if(e.markdown(`## \u{1F9E0} Your Memories

`),o.pendingCount>0&&e.markdown(`\u23F3 *${o.pendingCount} memories pending sync*

`),t.length===0)return e.markdown(`No memories yet. Create one with:

`),e.markdown("`@memory save [your content]`"),{metadata:{action:"list",count:0}};for(let n of t){let s=n._pending?" \u{1F504}":"";e.markdown(`- **${n.title}**${s}
`)}return e.markdown(`
*Showing ${t.length} most recent memories*`),{metadata:{action:"list",count:t.length}}}handleHelp(e){return e.markdown(`## \u{1F9E0} L0 Memory Assistant

`),e.markdown(`I help you store and recall your development context.

`),e.markdown(`### Commands

`),e.markdown(`| Command | Description |
`),e.markdown(`|---------|-------------|
`),e.markdown("| `@memory find [query]` | Search your memories |\n"),e.markdown("| `@memory save [content]` | Save a new memory |\n"),e.markdown("| `@memory list` | Show recent memories |\n"),e.markdown("| `@memory help` | Show this help |\n\n"),e.markdown(`### Examples

`),e.markdown("- `@memory find OAuth implementation`\n"),e.markdown("- `@memory what was that regex pattern?`\n"),e.markdown("- `@memory save Use PKCE flow for mobile OAuth`\n"),{metadata:{action:"help"}}}provideFollowups(e,t,o){switch(e.metadata?.action){case"search":return[{prompt:"list",label:"\u{1F4CB} Show all memories"},{prompt:"save ",label:"\u{1F4BE} Save a new memory"}];case"create":return[{prompt:"list",label:"\u{1F4CB} Show all memories"},{prompt:"find ",label:"\u{1F50D} Search memories"}];case"list":return[{prompt:"find ",label:"\u{1F50D} Search memories"},{prompt:"save ",label:"\u{1F4BE} Save a new memory"}];default:return[{prompt:"find ",label:"\u{1F50D} Search memories"},{prompt:"list",label:"\u{1F4CB} Show all memories"}]}}};var p={API_KEY:"lanonasis.apiKey",OAUTH_TOKENS:"lanonasis.tokens"},M=()=>c.workspace.getConfiguration("lzero").get("apiUrl")||"https://api.lanonasis.com/api/v1",K=["lano_","lns_"];function N(r){return K.some(e=>r.startsWith(e))}var m={clientId:"vscode-extension",authBaseUrl:"https://auth.lanonasis.com",redirectUri:"vscode://lanonasis.lzero-memory/callback",scope:"memories:read memories:write memories:delete profile"},L=class{constructor(e){this.output=e;this.pendingAuth=null}generateRandomString(e=32){return k.randomBytes(e).toString("base64url").slice(0,e)}generateCodeChallenge(e){return k.createHash("sha256").update(e).digest().toString("base64url")}buildAuthorizationUrl(e,t){let o=new URLSearchParams({client_id:m.clientId,response_type:"code",redirect_uri:m.redirectUri,scope:m.scope,code_challenge:e,code_challenge_method:"S256",state:t});return m.authBaseUrl+"/oauth/authorize?"+o.toString()}async exchangeCodeForTokens(e,t){let o=await fetch(m.authBaseUrl+"/oauth/token",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({grant_type:"authorization_code",code:e,client_id:m.clientId,redirect_uri:m.redirectUri,code_verifier:t})}),n=await o.json();if(!o.ok)throw new Error(n.error_description||n.error||"Token exchange failed");return n}handleCallback(e){if(!this.pendingAuth){this.output.appendLine("[LanOnasis] Received OAuth callback but no pending auth");return}let t=new URLSearchParams(e.query),o=t.get("code"),n=t.get("state"),s=t.get("error");if(s){let i=t.get("error_description")||s;this.pendingAuth.reject(new Error(i)),this.pendingAuth=null;return}if(n!==this.pendingAuth.state){this.pendingAuth.reject(new Error("State mismatch")),this.pendingAuth=null;return}if(!o){this.pendingAuth.reject(new Error("No authorization code received")),this.pendingAuth=null;return}this.pendingAuth.resolve(o)}async authenticate(){let e=this.generateRandomString(43),t=this.generateCodeChallenge(e),o=this.generateRandomString(32),n=this.buildAuthorizationUrl(t,o),s=new Promise((d,h)=>{this.pendingAuth={codeVerifier:e,state:o,resolve:d,reject:h},setTimeout(()=>{this.pendingAuth&&(this.pendingAuth.reject(new Error("OAuth flow timed out")),this.pendingAuth=null)},300*1e3)});if(this.output.appendLine("[LanOnasis] Opening browser for OAuth..."),!await c.env.openExternal(c.Uri.parse(n)))throw this.pendingAuth=null,new Error("Failed to open browser");let l=await s;this.output.appendLine("[LanOnasis] Exchanging code for tokens...");let a=await this.exchangeCodeForTokens(l,e);return this.pendingAuth=null,a}},b=class{constructor(e,t,o,n){this.context=e;this.output=t;this.oauthFlow=o;this.cache=n}static{this.viewType="lzero.memorySidebar"}resolveWebviewView(e,t,o){this.view=e;let n=e.webview;n.options={enableScripts:!0,localResourceRoots:[c.Uri.joinPath(this.context.extensionUri,"media")]},this.output.appendLine("[LanOnasis] Initializing sidebar webview"),n.html=this.getWebviewHtml(n),n.onDidReceiveMessage(s=>{if(!(!s||typeof s!="object")){if(s.type==="lanonasis:webview-ready"){this.output.appendLine("[LanOnasis] Webview ready"),n.postMessage({type:"lanonasis:host-ready"}),this.sendConfigToWebview(n);return}if(s.type==="lanonasis:request-auth"){this.handleOAuthLogin(n);return}if(s.type==="lanonasis:submit-api-key"){let i=s.payload?.apiKey;i&&this.handleApiKeySubmit(n,i);return}if(s.type==="lanonasis:logout"){this.handleLogout(n);return}if(s.type==="lanonasis:clipboard:read"){c.env.clipboard.readText().then(i=>{n.postMessage({type:"lanonasis:clipboard:read:result",payload:{text:i}})});return}if(s.type==="lanonasis:clipboard:write"){let i=s.payload?.text;typeof i=="string"&&c.env.clipboard.writeText(i);return}if(s.type==="lanonasis:cache:get"){let i=this.cache.getMemories(),l=this.cache.getStatus();n.postMessage({type:"lanonasis:cache:data",payload:{memories:i,status:l}});return}if(s.type==="lanonasis:cache:search"){let i=s.payload?.query;if(i){let l=this.cache.semanticSearchLocal(i);n.postMessage({type:"lanonasis:cache:search:result",payload:{results:l,query:i}})}return}if(s.type==="lanonasis:cache:add"){let i=s.payload?.memory;i&&this.cache.addLocal(i).then(l=>{n.postMessage({type:"lanonasis:cache:added",payload:{memory:l}})});return}if(s.type==="lanonasis:cache:sync"){this.syncMemories(n);return}if(s.type==="lanonasis:ai:search"){let i=s.payload?.query;i&&this.handleAISearch(n,i);return}}})}async syncMemories(e){this.cache.setSyncing(!0),e.postMessage({type:"lanonasis:sync:start"});try{let t=await this.getStoredApiKey();if(!t){e.postMessage({type:"lanonasis:sync:error",payload:{error:"Not authenticated"}});return}let o=M(),n=await fetch(`${o}/memories?limit=100`,{headers:{Authorization:`Bearer ${t}`,"Content-Type":"application/json"}});if(!n.ok)throw new Error(`API error: ${n.status}`);let s=await n.json(),i=s.memories||s||[];await this.cache.updateFromApi(i),this.cache.setOnline(!0),e.postMessage({type:"lanonasis:sync:complete",payload:{memories:i,status:this.cache.getStatus()}})}catch(t){this.cache.setOnline(!1),this.output.appendLine(`[LanOnasis] Sync error: ${t}`),e.postMessage({type:"lanonasis:sync:error",payload:{error:String(t)}})}finally{this.cache.setSyncing(!1)}}async handleAISearch(e,t){try{let o=this.cache.semanticSearchLocal(t);e.postMessage({type:"lanonasis:ai:search:local",payload:{results:o,query:t}});let n=await this.getStoredApiKey();if(n){let s=M(),i=await fetch(`${s}/memories/search?q=${encodeURIComponent(t)}&limit=10`,{headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(i.ok){let l=await i.json(),a=l.memories||l||[];e.postMessage({type:"lanonasis:ai:search:api",payload:{results:a,query:t}})}}}catch(o){this.output.appendLine(`[LanOnasis] AI search error: ${o}`)}}async getStoredApiKey(){try{let e=await this.context.secrets.get(p.OAUTH_TOKENS);if(e){let t=JSON.parse(e),n=(t.issued_at??Date.now())+t.expires_in*1e3;if(Date.now()<=n-300*1e3)return t.access_token}}catch{}try{return await this.context.secrets.get(p.API_KEY)}catch{}}async sendConfigToWebview(e){let t=c.workspace.getConfiguration("lzero"),o=c.workspace.getConfiguration("lanonasis"),n=t.get("apiUrl")||o.get("apiUrl")||"https://api.lanonasis.com/api/v1",s;try{let i=await this.context.secrets.get(p.OAUTH_TOKENS);if(i){let l=JSON.parse(i);if(l.scope&&(l.scope.includes("memory:")||l.scope.includes("api_keys:manage")))this.output.appendLine("[LanOnasis] Clearing cached tokens with old scopes"),await this.context.secrets.delete(p.OAUTH_TOKENS);else{let h=(l.issued_at??Date.now())+l.expires_in*1e3;Date.now()<=h-300*1e3&&(s=l.access_token,this.output.appendLine("[LanOnasis] Found valid OAuth token"))}}}catch(i){this.output.appendLine("[LanOnasis] Token error: "+String(i))}if(!s)try{let i=await this.context.secrets.get(p.API_KEY);i&&(s=i,this.output.appendLine("[LanOnasis] Found API key"))}catch(i){this.output.appendLine("[LanOnasis] API key error: "+String(i))}e.postMessage({type:"lanonasis:config:init",payload:{apiUrl:n,apiKey:s}})}async handleOAuthLogin(e){try{let t=await this.oauthFlow.authenticate();if(!t?.access_token)throw new Error("No tokens received");let o={...t,issued_at:Date.now()};await this.context.secrets.store(p.OAUTH_TOKENS,JSON.stringify(o)),e.postMessage({type:"lanonasis:auth:result",payload:{success:!0}}),e.postMessage({type:"lanonasis:config:update",payload:{apiKey:t.access_token}}),await c.window.showInformationMessage("LanOnasis: Connected via OAuth!")}catch(t){let o=t instanceof Error?t.message:String(t);this.output.appendLine("[LanOnasis] OAuth error: "+o),e.postMessage({type:"lanonasis:auth:result",payload:{success:!1,error:o}})}}async handleApiKeySubmit(e,t){try{if(!t||!N(t)){e.postMessage({type:"lanonasis:auth:result",payload:{success:!1,error:"Invalid API key format"}});return}await this.context.secrets.store(p.API_KEY,t),e.postMessage({type:"lanonasis:auth:result",payload:{success:!0}}),e.postMessage({type:"lanonasis:config:update",payload:{apiKey:t}}),await c.window.showInformationMessage("LanOnasis: Connected!")}catch(o){let n=o instanceof Error?o.message:String(o);e.postMessage({type:"lanonasis:auth:result",payload:{success:!1,error:n}})}}async handleLogout(e){try{await this.context.secrets.delete(p.API_KEY),await this.context.secrets.delete(p.OAUTH_TOKENS),e.postMessage({type:"lanonasis:config:update",payload:{apiKey:null}}),await c.window.showInformationMessage("LanOnasis: Logged out")}catch(t){this.output.appendLine("[LanOnasis] Logout error: "+String(t))}}postMessage(e){this.view&&this.view.webview.postMessage(e)}getWebviewHtml(e){let t=j(),o=e.asWebviewUri(c.Uri.joinPath(this.context.extensionUri,"media","sidebar-react.js")),n=e.asWebviewUri(c.Uri.joinPath(this.context.extensionUri,"media","lzero-memory.css"));return'<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta http-equiv="Content-Security-Policy" content="'+["default-src 'none'","img-src "+e.cspSource+" https: data:","style-src "+e.cspSource+" 'unsafe-inline'","font-src "+e.cspSource+" https: data:","script-src 'nonce-"+t+"' 'wasm-unsafe-eval'","connect-src https: wss: http://localhost:*"].join("; ")+'"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="stylesheet" href="'+n+'"/><title>LanOnasis Memory</title><style>body{background:var(--vscode-sideBar-background,#252526);color:var(--vscode-sideBar-foreground,#ccc);font-family:var(--vscode-font-family,sans-serif);margin:0;padding:0}#loading{padding:20px;text-align:center}#error{padding:20px;color:#f48771;display:none;white-space:pre-wrap;font-size:12px}</style></head><body><div id="loading">Loading L0 Memory...</div><div id="error"></div><div id="root"></div><script nonce="'+t+'">var errors=[];window.onerror=function(m,u,l){errors.push(m+" at "+u+":"+l);document.getElementById("error").style.display="block";document.getElementById("error").textContent="JS Error:\\n"+errors.join("\\n");document.getElementById("loading").style.display="none";return false};window.addEventListener("unhandledrejection",function(e){errors.push("Promise: "+(e.reason?.message||e.reason||"Unknown"));document.getElementById("error").style.display="block";document.getElementById("error").textContent="Promise Error:\\n"+errors.join("\\n");document.getElementById("loading").style.display="none"});</script><script nonce="'+t+'" type="module" src="'+o+`" onerror="document.getElementById('error').textContent='Failed to load script';document.getElementById('error').style.display='block';document.getElementById('loading').style.display='none';"></script><script nonce="`+t+'">var observer=new MutationObserver(function(){if(document.getElementById("root").children.length>0){document.getElementById("loading").style.display="none";observer.disconnect()}});observer.observe(document.getElementById("root"),{childList:true});setTimeout(function(){if(document.getElementById("root").children.length===0){document.getElementById("error").textContent="React failed to mount";document.getElementById("error").style.display="block";document.getElementById("loading").style.display="none"}},5000);</script></body></html>'}};function j(){let r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="";for(let t=0;t<32;t++)e+=r.charAt(Math.floor(Math.random()*r.length));return e}function B(r){let e=c.window.createOutputChannel("LanOnasis Memory");e.appendLine("[LanOnasis] Extension activating...");let t=new C(r,e),o=new L(e),n=c.window.registerUriHandler({handleUri(a){e.appendLine("[LanOnasis] URI callback: "+a.path),a.path==="/callback"&&o.handleCallback(a)}});r.subscriptions.push(n);let s=new b(r,e,o,t),i=async()=>{try{let a=await r.secrets.get(p.OAUTH_TOKENS);if(a)return JSON.parse(a).access_token}catch{}try{return await r.secrets.get(p.API_KEY)}catch{}};new S(r,e,t,M(),i).register(),r.subscriptions.push(c.window.registerWebviewViewProvider(b.viewType,s,{webviewOptions:{retainContextWhenHidden:!0}})),r.subscriptions.push(c.commands.registerCommand("lzeroMemory.authenticate",async()=>{try{let a=await o.authenticate();a.access_token&&(await r.secrets.store(p.OAUTH_TOKENS,JSON.stringify({...a,issued_at:Date.now()})),await c.window.showInformationMessage("LanOnasis: Authenticated!"))}catch(a){let d=a instanceof Error?a.message:String(a);await c.window.showErrorMessage("LanOnasis: Auth failed - "+d)}})),r.subscriptions.push(c.commands.registerCommand("lzeroMemory.createMemoryFromSelection",async()=>{let a=c.window.activeTextEditor;if(!a){await c.window.showInformationMessage("No active editor");return}let d=a.document.getText(a.selection);if(!d){await c.window.showInformationMessage("No text selected");return}s.postMessage({type:"lanonasis:inject-chat",payload:{text:d}}),await c.commands.executeCommand("lzero.memorySidebar.focus")})),r.subscriptions.push(c.commands.registerCommand("lzeroMemory.syncMemories",async()=>{s.postMessage({type:"lanonasis:cache:sync"}),await c.window.showInformationMessage("LanOnasis: Syncing memories...")})),r.subscriptions.push(c.commands.registerCommand("lzeroMemory.searchMemories",async()=>{let a=await c.window.showInputBox({prompt:"Search your memories",placeHolder:"e.g., OAuth implementation, regex pattern..."});if(a){let d=t.semanticSearchLocal(a);if(d.length===0){await c.window.showInformationMessage(`No memories found for "${a}"`);return}let h=d.map(u=>({label:u.title,description:u.memory_type,detail:u.content.slice(0,100)+(u.content.length>100?"...":""),memory:u})),g=await c.window.showQuickPick(h,{placeHolder:`Found ${d.length} memories`,matchOnDescription:!0,matchOnDetail:!0});g&&(await c.env.clipboard.writeText(g.memory.content),await c.window.showInformationMessage(`Copied "${g.label}" to clipboard`))}})),e.appendLine("[LanOnasis] Extension activated")}function F(){}0&&(module.exports={activate,deactivate});
